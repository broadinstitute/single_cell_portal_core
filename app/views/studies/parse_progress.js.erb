// set up vars
var spinnerTarget = $('<%= params[:modal_target]%>').find('.spinner-target');
var progressBar = $('<%= params[:modal_target]%>').find('.progress-bar');
var progressCount = $('<%= params[:modal_target]%>').find('.percent');

// first time this is called, turn off active spinner and show progress bar
if (spinnerTarget.css('display') == 'block') {
	spinnerTarget.data('spinner').stop();
	spinnerTarget.hide();
	$('<%= params[:modal_target]%>').find('.progress-wrapper').removeClass('hidden');
}

// increment progress
progressBar.css({width: "<%= @study_file.percent_parsed %>%"});
progressCount.html("<%= @study_file.percent_parsed %>%");

// if incomplete, call self again
if (<%= @study_file.parse_status != 'parsed' %>) {
	setTimeout(function() {
		$.get("<%= parse_progress_study_path(@study._id) %>", {file: '<%= @study_file.name %>', modal_target: '<%= params[:modal_target]%>'});
	}, 1000);
}