<script type="text/javascript" nonce="<%= content_security_policy_script_nonce %>">
    $('#selection-submit').click(function(){
        var currentName = $('#user_annotation_name').val();
        var needText = $('.need-text');
        var numFields = needText.toArray().length;
        var values = [];
        var cont = true;
        for(i = 0; i < numFields; i++){
            var text = needText.eq(i).val();
            values.push(text);
            if(text === ""){cont = false}
        }

        if (numFields < 3) {
            alert('Your annotation must have at least two populations');
        } else if ( !cont ) {
            alert('You must provide a value for all labels before saving');
            setErrorOnBlank(needText);
        } else if (values.includes('Undefined')) {
            alert('Undefined is a reserved term. Select a different name for this label.');
            setErrorOnBlank(needText);
        } else {
            $('#generic-modal-title').html("Saving... Please Wait");
            ga('send', 'event', 'engaged_user_action', 'create_custom_cell_annotation');
            SCP.log('create-custom-cell-annotation');
            launchModalSpinner('#generic-modal-spinner', '#generic-modal', function() {
                var form = $('#selection-well > form');
                form.submit();
            });

        }

    });
</script>
